{"version":3,"sources":["../../src/server/controllers/appointment-controller.js"],"names":["_","load","req","res","next","id","get","then","appointment","catch","e","create","body","save","savedAppointment","update","prop","list","query","limit","skip","buildQuery","parseInt","populate","sort","appointments","dateKeys","Object","keys","length","find","seriesObj","key","obj","indexOf","$gt","$lt","remove","deletedAppointment"],"mappings":"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","file":"appointment-controller.js","sourcesContent":["import {Appointment} from '../models';\r\nimport APIError from '../lib/APIError';\r\nimport httpStatus from 'http-status';\r\nimport Constants from '../lib/constants';\r\nimport * as _ from 'lodash';\r\n\r\n/**\r\n* Load appointment and append to req.\r\n*/\r\nfunction load(req, res, next, id) {\r\n    Appointment.get(id)\r\n    .then((appointment) => {\r\n        req.appointment = appointment;\r\n        return next();\r\n    })\r\n    .catch(e => next(e));\r\n}\r\n\r\n/**\r\n* Get appointment\r\n* @returns {Appointment}\r\n*/\r\nfunction get(req, res) {\r\n    return req.appointment;\r\n}\r\n\r\n/**\r\n* Checks if user exists with same email as appointment.  If not, it creates a new User with the email provided and a default password. Then creates the Appointment to reside in the new user\r\n* @returns {Appointment}\r\n*/\r\nfunction create(req, res, next) {\r\n   return new Appointment(req.body)\r\n        .save()\r\n        .then(savedAppointment => savedAppointment)\r\n        .catch(e => next(e));\r\n}\r\n\r\n/**\r\n* Update existing appointment\r\n* @returns {Appointment}\r\n*/\r\nfunction update(req, res, next) {\r\n    const appointment = req.appointment;\r\n    for(let prop in req.body){\r\n        appointment[prop] = req.body[prop];\r\n    }\r\n    return appointment.save()\r\n    .then(savedAppointment => savedAppointment)\r\n    .catch(e => next(e));\r\n}\r\n\r\n/**\r\n* Get appointment list.\r\n* @property {number} req.query.skip - Number of appointments to be skipped.\r\n* @property {number} req.query.limit - Limit number of appointments to be returned.\r\n* @returns {Appointment[]}\r\n*/\r\nfunction list(req, res, next) {\r\n    const { limit = 10, skip = 0 } = req.query;\r\n    delete req.query.limit;\r\n    delete req.query.skip;    \r\n    let query = Appointment;\r\n    query = buildQuery(req, query);\r\n    return query.skip(parseInt(skip)).limit(parseInt(limit))\r\n    .populate('client professional')\r\n    .sort('startDate')\r\n    .then(appointments => appointments)\r\n    .catch(e => next(e));\r\n}\r\n\r\n//list of fields that are relationships of type many\r\nlet dateKeys = ['startDate', 'endDate'];\r\n\r\n//builds a query for \r\nfunction buildQuery(req, query){\r\n    if(Object.keys(req.query).length === 0)\r\n        return query.find();\r\n    //otherwise it runs it as an OR statement\r\n    let seriesObj = {};\r\n    for(let key in req.query){\r\n        let obj = {};\r\n        if(_.indexOf(dateKeys, key) > -1){\r\n            if(key == 'startDate')\r\n                obj[key] = {$gt: req.query[key]};\r\n            if(key == 'endDate')\r\n                obj[key] = {$lt: req.query[key]};\r\n            query = query.find(obj);    \r\n        } else{\r\n            seriesObj[key] = req.query[key];\r\n        }\r\n    }\r\n    if(Object.keys(seriesObj).length > 0)\r\n        query = query.find(seriesObj);\r\n    return query;\r\n}\r\n\r\n/**\r\n* Delete appointment.\r\n* @returns {Appointment}\r\n*/\r\nfunction remove(req, res, next) {\r\n    const appointment = req.appointment;\r\n    return appointment.remove()\r\n    .then(deletedAppointment => deletedAppointment)\r\n    .catch(e => next(e));\r\n}\r\n\r\nexport default { load, get, create, update, list, remove };\r\n"]}