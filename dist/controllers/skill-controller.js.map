{"version":3,"sources":["../../src/server/controllers/skill-controller.js"],"names":["load","req","res","next","id","get","then","skill","catch","e","search","regex","RegExp","params","keyword","find","targetName","$regex","organization","query","exec","skills","create","body","save","savedSkill","update","prop","list","limit","skip","queryObj","buildQuery","length","$or","sort","createdAt","populate","Object","keys","array","key","obj","push","remove","deletedSkill"],"mappings":"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","file":"skill-controller.js","sourcesContent":["import {Skill} from '../models';\r\nimport APIError from '../lib/APIError';\r\nimport httpStatus from 'http-status';\r\nimport Constants from '../lib/constants';\r\n/**\r\n* Load skill and append to req.\r\n*/\r\nfunction load(req, res, next, id) {\r\n    Skill.get(id)\r\n    .then((skill) => {\r\n        req.skill = skill;\r\n        return next();\r\n    })\r\n    .catch(e => next(e));\r\n}\r\n\r\n/**\r\n* Get skill\r\n* @returns {Skill}\r\n*/\r\nfunction get(req, res) {\r\n    return req.skill;\r\n}\r\n\r\n/**\r\n* Get skill\r\n* @returns {Skill}\r\n* https://medium.com/@apurvashastry/build-a-cool-database-search-using-these-mongodb-full-text-search-features-on-mongoose-cf2803257f9\r\n*/\r\nfunction search(req, res, next) {\r\n    var regex = new RegExp(req.params.keyword,'ig')\r\n    return Skill.find({\r\n        targetName: {\r\n            $regex: regex\r\n        },\r\n        organization: req.query.organization\r\n    })\r\n    .exec()\r\n    .then((skills) => skills)\r\n    .catch(e => next(e));\r\n}\r\n\r\n/**\r\n* Checks if user exists with same email as skill.  If not, it creates a new User with the email provided and a default password. Then creates the Skill to reside in the new user\r\n* @returns {Skill}\r\n*/\r\nfunction create(req, res, next) {\r\n    return new Skill(req.body)\r\n        .save()\r\n        .then(savedSkill => savedSkill)\r\n        .catch(e => next(e));\r\n}\r\n\r\n/**\r\n* Update existing skill\r\n* @returns {Skill}\r\n*/\r\nfunction update(req, res, next) {\r\n    const skill = req.skill;\r\n    for(let prop in req.body){\r\n        skill[prop] = req.body[prop];\r\n    }\r\n    return skill.save()\r\n    .then(savedSkill => savedSkill)\r\n    .catch(e => next(e));\r\n}\r\n\r\n/**\r\n* Get skill list.\r\n* @property {number} req.query.skip - Number of skills to be skipped.\r\n* @property {number} req.query.limit - Limit number of skills to be returned.\r\n* @returns {Skill[]}\r\n*/\r\nfunction list(req, res, next) {\r\n    const { limit = 20, skip = 0 } = req.query;\r\n\r\n    let queryObj = buildQuery(req);\r\n    \r\n    return Skill.find(queryObj.length > 0 ? {$or: queryObj} : {})\r\n        .sort({ createdAt: -1 })\r\n        .populate('targetType dttType')\r\n        .skip(skip)\r\n        .limit(limit)\r\n        .then(skills => skills)\r\n        .catch(e => next(e));\r\n\r\n\r\n    // Skill.list({ limit, skip })\r\n    // .then(skills => res.json(skills))\r\n    // .catch(e => next(e));\r\n}\r\n\r\nfunction buildQuery(req){\r\n    if (Object.keys(req.query).length === 0) return [];\r\n    var array = [];\r\n    for (var key in req.query) {\r\n        var obj = {};\r\n        obj[key] = req.query[key];\r\n        array.push(obj);\r\n    }\r\n    return array;\r\n}\r\n\r\n\r\n/**\r\n* Delete skill.\r\n* @returns {Skill}\r\n*/\r\nfunction remove(req, res, next) {\r\n    const skill = req.skill;\r\n    return skill.remove()\r\n    .then(deletedSkill => deletedSkill)\r\n    .catch(e => next(e));\r\n}\r\n\r\nexport default { load, get, create, update, list, remove, search };\r\n"]}