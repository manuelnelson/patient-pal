{"version":3,"sources":["../src/server/db.js"],"names":["Promise","require","mongoUri","process","env","MONGODB_URI","MONGO_HOST","connect","db","connection","on","console","error","bind","once","any","then","run","targets","ddts","callback"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;kBAEe,oBAAY;AAC1B,oBAASA,OAAT,GAAmBC,QAAQ,UAAR,CAAnB;AACA,KAAIC,WAAWC,QAAQC,GAAR,CAAYC,WAAZ,IAA2BF,QAAQC,GAAR,CAAYE,UAAtD;AACA,oBAASC,OAAT,CAAiBL,QAAjB;AACA,KAAIM,KAAK,mBAASC,UAAlB;AACAD,IAAGE,EAAH,CAAM,OAAN,EAAeC,QAAQC,KAAR,CAAcC,IAAd,CAAmBF,OAAnB,EAA4B,mBAA5B,CAAf;AACAH,IAAGM,IAAH,CAAQ,MAAR,EAAgB,YAAM;AACrB;AACA,uBACEC,GADF,GAEEC,IAFF,CAEO;AAAA,UAAW,qBAAeC,GAAf,CAAmBC,OAAnB,CAAX;AAAA,GAFP;;AAIA,oBACEH,GADF,GAEEC,IAFF,CAEO;AAAA,UAAQ,kBAAQC,GAAR,CAAYE,IAAZ,CAAR;AAAA,GAFP;;AAIE;AACAC,WAASZ,EAAT;AACF,EAZD;AAcA,C","file":"db.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport SeedTargetType from './seed/targetType';\r\nimport SeedDdt from './seed/dttType';\r\n\r\nexport default callback => {\r\n\tmongoose.Promise = require('bluebird');\r\n\tlet mongoUri = process.env.MONGODB_URI || process.env.MONGO_HOST;\r\n\tmongoose.connect(mongoUri);\r\n\tlet db = mongoose.connection;\r\n\tdb.on('error', console.error.bind(console, 'connection error:'));\r\n\tdb.once('open', () => {\r\n\t\t//check update scripts\r\n\t\tSeedTargetType\r\n\t\t\t.any()\r\n\t\t\t.then(targets => SeedTargetType.run(targets))\r\n\r\n\t\tSeedDdt\r\n\t\t\t.any()\r\n\t\t\t.then(ddts => SeedDdt.run(ddts))\r\n\r\n\t\t  // we're connected!\r\n\t\t  callback(db);\r\n\t});\r\n\r\n}\r\n"]}